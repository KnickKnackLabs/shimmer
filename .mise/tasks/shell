#!/usr/bin/env bash
#MISE description="Output shell configuration for global shimmer command (use with eval)"
REPO_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/../.." && pwd)"

# Create shim so shimmer is callable from scripts and subprocesses
BIN_DIR="$HOME/.local/bin"
BIN="$BIN_DIR/shimmer"
mkdir -p "$BIN_DIR"
cat > "$BIN" <<SCRIPT
#!/usr/bin/env bash
REPO="$REPO_DIR"
if [ ! -d "\$REPO" ]; then
  echo "shimmer: repo not found at \$REPO" >&2
  echo "shimmer: re-run 'eval \"\\\$(mise -C /path/to/shimmer run -q shell)\"' to fix" >&2
  exit 1
fi
CALLER_PWD="\${CALLER_PWD:-\$PWD}" exec mise -C "\$REPO" run "\$@"
SCRIPT
chmod +x "$BIN"

# Ensure ~/.local/bin is on PATH (skip if already there)
case ":$PATH:" in
  *":$BIN_DIR:"*) ;;
  *) echo "export PATH=\"$BIN_DIR:\$PATH\"" ;;
esac

# Shell alias (captures caller's PWD for interactive use)
echo "alias shimmer='CALLER_PWD=\"\$PWD\" mise -C \"$REPO_DIR\" run'"
